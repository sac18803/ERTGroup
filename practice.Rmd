[Introduction](#Introduction)

<h1>

Introduction

</h1>

<p><b>Context</b></p>
<p>The data in this study reports video games sales in EU, NA, Japan, and other places. Inlcuded also are the names of the games, the platform, publisher, year, and the rank in sales. 
<p>

Other analyses completed

</p>

<p>
Gap of this analysis

</p>

<h2>

The Analysis Question

</h2>

<p><b>The question/objectives in this analysis is</b></p>
<ul>
<li>To explore the data and find various patterns and trends</li>
<li>Determine which Platforms and Genres are successful in Japan</li>
<li>Predict Japanese Sales</li>
</ul>
<p>The priamry benefit of predicting Japanese sales is a company can determine what genres and platforms to offer in Japan.</p>
<p><b>KPIs</b></p>
<p>The prediction of Japanese sales is the primary KPI. This metric will be assessed using the following tools.</p>
<ul>
<li>Summary statistics</li>
<li>Mean absolute error</li>
<li>Correlation</li>
</ul>
<h2>
        
Solution Overview

</h2>

<ul>

<li>Gradient boosting was employed to predict Japanese video game sales</li>

<li>The OLS regression model indicated which genre and platforms were significant</li>

<li>The boosted regression model indicated which variables where of importance</li>

</ul>

<h1>

Importing Packages and Data

</h1>

<h2>

Packages

</h2>

```{r include=FALSE}
library(ggplot2);library(janitor)
library(dplyr);library(gbm)
library(tidyr);library(Rmisc)
library(lubridate);library(MASS);library(corrplot)
library(caret); library(ISLR); library(ggplot2)
#inTrain<-createDataPartition(y=College$education,  p=0.7, list=FALSE)
#trainingset <- College[inTrain, ]
#testingset <- College[-inTrain, ]
#library(randomForest)
```

<h1>

Data/ Scrubbing/exploring

</h1>

```{r}
library(readr)
vgsales <- read_csv("vgsales.csv")
summary(vgsales)
```
<h2>Continuous Variables</h2>
<p>Below is a correlation matrix</p>
```{r}
cor(vgsales[,7:11]) %>%corrplot(method = 'number')
```
<b>Observations</b>
<p>It appears that there is a strong correlation between NA and EU sales and between EU and other sales. Global sales is a sum so it makes sense that it's correlation is so high. However, Japanese sales are different from the other sales as its correlation with global sales is low compared to the other variables.</p>
<b>Purpose</p>
<p>We already know what the descriptive states are but now lets look at some histograms         </p>

```{r}
ggplot(vgsales,aes(NA_Sales))+geom_histogram()
ggplot(vgsales,aes(EU_Sales))+geom_histogram()
ggplot(vgsales,aes(JP_Sales))+geom_histogram()
ggplot(vgsales,aes(Other_Sales))+geom_histogram()
```

<p><b>Observation</b></p>
<p>none of the continuous variables follow a normal distribution. This means we will need to do a log transformation when developing the model</p>

<h1>Categorical Variables</h1>
<p>A look at the summary doesn't indicate any major problems with the data. We will double check for duplicates and missing values below.</p>

```{r}
print(table(duplicated(vgsales)))
print(table(is.na(vgsales)))
```
<p>Both outputs indicate there are no duplicates or missing values.  Well now look at the categorical variables a little more closely.</p>

<b>Purpose</b>
<p>Check categorical variables</p>

```{r}
length(unique(vgsales$Name))
table(vgsales$Platform)
table(vgsales$Year)
```
<ul>
<li>There are a lot of names in the name category and none of them are that common.</li> 
<li>In addition, there are a lot of different platforms.</li>
<li> Looking by year we can see that there are different amounts of data for each year. What this means is that data from the 1990's and 2000's is going to heavily influence the model because more data comes from that time. This will make it hard to determine if different years were more profitable than others.</li>
<li>Lastly, the year column does have missing values but they were coded in a way that the function I used could detect them. Since the value is small I can probably just leave these values out when year is a criteria.</li></ul>

<h2>Categorical Visualizations</h2>

<b>Purpose</b>
<p>Our first visualization will look at the count of sales over time.</p> 

```{r}
vgsales %>% dplyr::transmute(Year=as.numeric(Year)) %>%filter(Year != 'N/A') %>%
        group_by(Year) %>%dplyr::count(Year) %>%
        ggplot(aes(Year,n,group=1))+geom_line()+ggtitle('Titles Sold Over Time')+labs(y="Count")
```
<p><b>Observation</b></p>
<p>From this first chart we can see the units sold peak in the 2008 and 2009 and began to decline steep after 2011. This makes sense because most of the data comes from the 1990's and 2000's</p>

<h3>Visual 2</h3>
<p><b>Purpose</b></p>
This second chart shows Japanese sales over time and rough follows the pattern of the previous plot.


```{r}
vgsales %>% dplyr::transmute(Year,JP_Sales) %>% dplyr::filter(Year != 'N/A') %>%
        dplyr::group_by(Year) %>% dplyr::summarize(all_sales=sum(JP_Sales)) %>%
       ggplot(aes(Year,all_sales,group=1))+geom_line()+ggtitle('Japanese Sales Over Time') +
        scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+labs(y='JP Sales')
```
<p><b>Observation</b></p>
<p>From this first chart we can see the sales peak in the 2008 and 2009 and began to decline steep after 2011. Again this is because of when most of our data came from</p>

<h3>Visual 3 & 4</h3>
<p><b>Purpose</b></p>
<p>This chart shows Units sold over time while considering the various platforms that were available while plot 4 shows units sold by platform.</p>

```{r}
vgsales %>% filter(Year !='N/A') %>%
        ggplot(aes(x = factor(Year), fill = factor(Platform))) +
        geom_bar() +
        scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+ggtitle('Sales by Platform and Year')+labs(x='Year')+labs(fill = "Platform")
      
```
<b>Observation></b>
<p>Nintendo generally dominants the platform business followed by PlayStation</p>

<b>Purpose</b>
<p>Determine how many units were sold by platform</p>

```{r}
vgsales %>% dplyr::select(Platform) %>% dplyr::group_by(Platform)%>% dplyr::count(Platform) %>%
ggplot(aes( x= reorder(Platform, +n), y = n))+geom_bar(stat='identity')+coord_flip()+ggtitle('Units Sold by Platform')+labs(x=('Platform'),y=('Count'))
```
<p><b>Observation</b></p>
<p>The Nintendo DS and PS2 are the top platforms sold in terms of units all-time in this dataset. In addition, Nintnendoo and Sony hold the top four spots. Sony controls 4 of the top 6 spots indicating that Sony is the top Platform maker.</p> 



<h3>Visual 5</h3>
<p><b>Purpose</b></p>
<p>This chart shows Japanese sales by Platform</p>
```{r}
vgsales %>% dplyr::select(Platform, JP_Sales) %>%dplyr::group_by(Platform) %>%
        dplyr::summarize(total_sales_platform=sum(JP_Sales)) %>% 
        ggplot(aes(reorder(Platform,+total_sales_platform),total_sales_platform)) + geom_bar(stat='identity')+coord_flip()+ggtitle('Global Sales by Platform')+labs(x="Platform",y="Total Sales")
                          
```


<p><b>Observation</b></p>
<p>The Nintendo DS has sold the  most units but the PS2 has generate the most money followed by the x360. The falloff in sales for the older platforms is probably a combination of the older units nomrally have a lower price compared to the price of platforms today. In addition, the gaming indsutry has grown tremendously over the years.</p> 

<h3>Visual 5</h3>
<p><b>Purpose</b></p>
<p>This chart shows Units sold while considering the various genres.</p>


```{r}
vgsales %>% dplyr::select(Genre) %>% dplyr::group_by(Genre)%>% dplyr::count(Genre) %>%
ggplot(aes( x= reorder(Genre, +n), y = n))+geom_bar(stat='identity')+coord_flip()+ggtitle("Totals Sold by Genre")+labs(x="Genre",y="Count")

```
<p><b>Observation</b></p>
<p>Action games are the most popular in terms of units sold. This might be signficant when predict sales for Japan. Puzzle games don't seem to sale well in comparision to other genres that are available.</p> 

<h3>Visual 6</h3>
<p><b>Purpose</b></p>
<p>This chart shows Sales  while considering the various genres.</p>
```{r}
vgsales %>% dplyr::select(Genre, JP_Sales) %>%dplyr::group_by(Genre) %>%
        dplyr::summarize(total_sales_genre=sum(JP_Sales)) %>% 
        ggplot(aes(reorder(Genre,+total_sales_genre),total_sales_genre)) + geom_bar(stat='identity')+coord_flip()+ggtitle('Sales by Genre in Japan')+labs(x="Genre",y="Total Sales")
```

<p><b>Observation</b></p>
<p>Japanese love role-playing games by far. From there the pattern is similiar to the previous plot</p> 


<h3>Visual 7</h3>
<p><b>Purpose</b></p>
<p>This chart shows Sales while considering the various select Platforms over time</p>

```{r}
vgsales %>% dplyr::select(Year,Platform,JP_Sales)%>%
        dplyr::filter(Platform==c('DS','PS2','PS3','Wii','X360','PS','GBA','PSP') & Year!=('N/A'))%>%
        dplyr::group_by(Year,Platform) %>%   dplyr::summarize(total_sales=sum(JP_Sales)) %>%ggplot(aes(Year,total_sales,group=1))+geom_line()+facet_wrap(~Platform)+
        scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+ggtitle("Platform Sales and Time")+labs(y='Total Sales')

```

<p><b>Observation</b></p>
<p>The nintendo platforms seem to be wildly popular with a steep decline. Sony and Microsoft systems usually have a slightly more staying power. Again, all time data is inlfuence by the amount of data available per year which was scarce ac times </p> 

<h3>Visual 8</h3>
<p><b>Purpose</b></p>
<p>This chart shows Sales while considering the various genres over time</p>

```{r}
vgsales %>% dplyr::select(Year, JP_Sales,Genre) %>% filter(Year!='N/A') %>% 
        dplyr::group_by(Year,Genre) %>% 
        dplyr::summarize(total_sales=sum(JP_Sales))%>%
        ggplot(aes(Year,total_sales,group=1))+geom_line()+facet_wrap(~Genre)+
        scale_x_discrete(guide = guide_axis(check.overlap = TRUE))
```

<p><b>Observation</b></p>
<p>Role-Playing games were the best performers over the years. Platforms, strategy, adventures, and fighting have the most consistent performance. </p> 

<h3>Visual 9</h3>
<p><b>Purpose</b></p>
<p>This chart shows the best selling game in terms of revenue by year.</p>


```{r eval=FALSE, include=FALSE}
```{undefined eval=FALSE, include=FALSE}
ggplot(best_selling,aes(Year,Global_Sales, fill=Name))+geom_bar(stat='identity') + scale_x_discrete(guide = guide_axis(check.overlap = TRUE))+ggtitle('Best Selling Game By Year')

```
```{r}
knitr::include_graphics("good.png")
```


<p><b>Observation</b></p>
<p>Wii sports was the best selling game in term of revenue by far</p> 

<h3>Visual 9</h3>
<p><b>Purpose</b></p>
<p>This chart shows the average sales by genre.</p>

```{r}
genre_totals<-vgsales%>%dplyr::select(Genre,JP_Sales) %>%dplyr::count(Genre)

sales<-vgsales%>%dplyr::select(Genre,JP_Sales) %>%dplyr::group_by(Genre)%>%  
        dplyr::summarize(total_sales=sum(JP_Sales))
sales$total_sales/genre_totals$n

genre_totals$total_sales<-sales$total_sales
sum(genre_totals$total_sales)

genre_totals%>% dplyr::mutate(avg=(total_sales/n)) %>%
        ggplot(aes(reorder(Genre,+avg),avg))+geom_bar(stat='identity')+ggtitle('Average Japanese Sales by Genre')+labs(x='Genre')+coord_flip()
```
<p><b>Observation</b></p>
<p>A role-playing game was on average generate much more revenue than other genres. Despite action and sports have a large number of units sold the actual average sales generate was low. </p> 


<h1>

Data Prep

</h1>
<p>We now moving to model development. There are too many Publishers to make a understandable model. Therefore, we will take the top twenty publishers for are model. Below is the code and output for this experience</p>
```{r}
publisher_select<-vgsales %>%dplyr:: select(Publisher) %>%dplyr::group_by(Publisher)%>%dplyr::count(Publisher,sort=T)%>%
        dplyr::ungroup() %>% dplyr::transmute(Publisher,n,new=n/sum(n))
pub_names<-(publisher_select$Publisher[1:20])  
pub_names_plot<-(publisher_select[1:20,])

ggplot(pub_names_plot,aes(reorder(Publisher,+n),n))+geom_bar(stat='identity')+coord_flip()+ggtitle('Count by Publisher')+labs(x='Publisher',y='Count')
```


<p>If we take the top 20 publishers we still have 65% of the data as shown below</p>
```{r}
sum(publisher_select$new[1:20])
```
<h3>Dealing with the Platforms</h3>
<p> The platforms also need to be simplified for interpretation. For example all the PS have been recoded as Sony and the same with the Nintendo platforms. When it was not clear what manufacturer a platform belong to it was recoded as other</p>

```{r}
vgsales_clean<-vgsales %>% mutate(simple_platform=recode(Platform, `Wii`="Nintendo",`NES`="Nintendo",`GB`="Nintendo",`DS`="Nintendo",`X360`="Microsoft",`PS3`="Sony",`PS2`="Sony",`SNES`="Nintendo",
`GBA`="Nintendo",`3DS`="Nintendo",`PS4`="Sony",`N64`="Nintendo",`PS`="Sony",`XB`="Microsoft",`2600`="Other",
`PSP`="Sony",`XOne`="Microsoft",`GC`="Nintendo",`WiiU`="Nintendo",`GEN`="Other",`DC`="Sega",`PSV`="Sony",
`SAT`="Sega",`SCD`="Other",`WS`="Other",`NG`="Other",`TG16`="Other",`3DO`="Other",`GG`="Sega",`PCFX`="Other",))   
```


<h3>Log Transformation</h3>
<p> We also need to do a log transformation of the continuous variables. In addition, because log cannot handle zeros we have to add a constant of 1 to each value so we do not get an error. We will reverse this when it is time for interpretation.</p>

```{r}
vgsales_clean<-vgsales_clean%>%filter(Publisher %in% pub_names)
vgsales_clean$log_JP_Sales<-log(vgsales_clean$JP_Sales+1)
vgsales_clean$log_NA_Sales<-log(vgsales_clean$NA_Sales+1)
vgsales_clean$log_EU_Sales<-log(vgsales_clean$EU_Sales+1)
vgsales_clean$log_Other_Sales<-log(vgsales_clean$Other_Sales+1)
```

<h1> Model Development</h1>

<p> Below we divide are dataset into train and test sets</p>

```{r}
set.seed(123)
ind<-sample(2,nrow(vgsales_clean),replace=T,prob = c(0.7,0.3))
train<-vgsales_clean[ind==1,]
test<-vgsales_clean[ind==2,]
```

<p>I like to always begin with a regression model just to get an insight into the data before completing a more complex analysis.</p>
```{r}
summary(lm(log_JP_Sales~log_NA_Sales+log_EU_Sales+log_Other_Sales+Genre+Publisher+simple_platform,train))

```
<p>The results indicate that there are many significant differences within the Publisher categorical variable and also among the platforms. Role-playing is signficant among the genres along with other groups. The continuous variables also show a significant relationship Japanese sales. The overall variance explained is 43% which might be considered low in a finance context.</p> 

<h2>

Parameter Tuning

</h2>

<p>Below we set up the parameter tuning for our boosted random forest</p>
```{r}
#grid development
grid<-expand.grid(.n.trees=seq(100,500,by=100),.interaction.depth=seq(1,4,by=1),.shrinkage=c(.001,.01,.1),
                  .n.minobsinnode=10)
control<-trainControl(method = "cv", repeats=10)
```

<h2>Model Training</h2>
<p> Now we train our model using the settings from the parameter tuning</p>
```{r include=FALSE}
gbm.train<-train(log_JP_Sales~log_NA_Sales+log_EU_Sales+log_Other_Sales+Publisher+Genre+simple_platform,data=train,method='gbm',trControl=control,tuneGrid=grid)
gbm.train

```

<p>Based on the feedback from the tuning we can use these values to for our model. Followed by an output that shows us the importance of easch variable.</p>

```{r}
gbm.sales<-gbm(log_JP_Sales~log_NA_Sales+log_EU_Sales+log_Other_Sales+as.factor(Publisher)+as.factor(Genre)+as.factor(simple_platform),data=train,n.trees = 500,interaction.depth = 4,
               shrinkage = .1,distribution = 'gaussian')
 summary(     gbm.sales, cBars = 40,method = relative.influence, las = 3)
```

<p>It appears that the publisher is the most important factor in determining sales in Japan having almost half of the influence. North American and European Sales also have high importance. Other sales and platofrm do not seem to be that important.</p>

<h2>Model Evaluation</h2>

<p>
Below, we are going to use or test data in order to evaluate the model

</p>

```{r}
gbm.test<-predict(gbm.sales,newdata = test,n.trees = 500,interaction.depth = 4,
                  shrinkage = .1,distribution = 'gaussian')
```

<h3>Residuals</h3>
<p>First we take a look at the residuals which is useful for comparing models.</p>

```{r}
gbm.resid<-gbm.test-test$log_JP_Sales
mean(gbm.resid^2)

```
<p>We want this number to be as low as possible as it indicates less error in the model.</p>

<h3>Comparing Summary Statistics</P
<p>Another tool for examining models is to compare the descriptive statistics of the predicted model with the test data.</p>

```{r}
exp(summary(gbm.test-1))
exp(summary(test$log_JP_Sales-1))
```
<p>The values are similar at the mean but really begin to struggle at higher values. This indicates that the model is good at predict typical or average sales but struggle with blockbuster or highly successful games.</p>

<h3>Mean Absolute Error</h3>
```{r}
exp(mean(abs((test$log_JP_Sales-gbm.test))-1))

```
What this tells us is that the avaerage difference between the actual and predicted values is 0.3880155. In order for this to make sense we have to convert this into millions of dollars which becomes \$388,015. We need to compare this value to the mean absolute error to the mean of our model

```{r}
exp(mean(abs(mean(train$log_JP_Sales)-test$log_JP_Sales)-1))

```
<p>The value about is 0.4055417 and when we multiplied it by one million we get \$405,541.7 which is close to the calculated MAE. We want there to be a large difference between these two numbers. If not it means are model is not much better than the mean at predicting future values.</p>
<h3>Correlation, Plots, and Confidence Interval</h3>
<p>We will now look at the correlation between the predicted and actual values</p>

```{r}
cor(gbm.test,test$log_JP_Sales)
```

<p> The correlation is high but we need to confirm this with a visual.</p>

```{r}
plot(gbm.test,test$log_JP_Sales)
```
<p>There is a trend but the problem is all the values that are lumped together near the bottom. This indicates that most games dont make a lot of money but there are a lot of exceptions. In other words, something else explains Japanese sales in addition to what is in this model.</p>

```{r eval=FALSE, include=FALSE}


CI(exp(gbm.test)-1)
```

<h1>Interpreting/Conclusions</h1>

<h2>The Data</h2>

<ul>
<li>The publisher is the most important variable in determining Japanese sales</li>
<li>There are a lot of games that do not sale that well and a handful of games that are all-time greats</li>
<li>Role-Playing games are a big hit in Japan along with games by Electronic Arts</li>

</ul>

<h2>The Code</h2>

<ul>

<li>The EDA provides insights in global sales as well as sales in Japan</li>

<li>This analysis provides insight into which platforms, genres, and publishers to focus on boosting sales in Japan</li>

<li>The model predicts sales of video games in Japan</li>

</ul>

<h2>Limitations</h2>

<ul>

<li>The majority of the data came from the 1990's and 2000's making it hard to predict Japanese sales in the 2020's</li>

<li>Individual games were all unique which means it was not reasonable to include this variable in the model</li>

<li>The model does not do good job estimating lower selling games</li>

</ul>
